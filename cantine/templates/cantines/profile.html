{% extends "cantines/base.html" %}

{% block title %}Mon profil · Gestion Cantine HEG{% endblock %}

{% block content %}
<section class="container py-12">
    <div class="mx-auto max-w-4xl rounded-3xl bg-white p-10 shadow-2xl">
        <div class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
            <div>
                <p class="text-xs uppercase tracking-[0.35em] text-heg-gris/60">Compte utilisateur</p>
                <h2 class="mt-2 text-3xl font-semibold text-heg-violet">Paramètres du profil</h2>
                <p class="mt-2 text-sm text-heg-gris/80">Mettez à jour votre photo, vos coordonnées et votre fonction.</p>
            </div>
            <div class="flex items-center gap-4">
                {% if profile.avatar %}
                    <img src="{{ profile.avatar.url }}" alt="Photo de profil" class="h-24 w-24 rounded-full object-cover ring-4 ring-heg-violet/30 shadow-lg">
                {% else %}
                    <div class="flex h-24 w-24 items-center justify-center rounded-full bg-heg-violet/10 text-2xl font-semibold text-heg-violet ring-4 ring-heg-violet/30 shadow-lg">
                        {{ user.first_name|default:user.username|slice:":2"|upper }}
                    </div>
                {% endif %}
                <div>
                    <p class="text-lg font-semibold text-heg-violet">{{ user.get_full_name|default:user.username }}</p>
                    <p class="text-sm text-heg-gris/70">{{ user.email }}</p>
                    <span class="mt-1 inline-flex items-center rounded-full bg-heg-violet/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-heg-violet">
                        {{ profile.get_role_display }}
                    </span>
                </div>
            </div>
        </div>

        <form method="post" enctype="multipart/form-data" class="mt-8 grid gap-5 md:grid-cols-2">
            {% csrf_token %}
            <div class="md:col-span-2">
                <label class="label text-sm font-medium text-heg-gris">Photo de profil</label>
                {{ form.avatar }}
                <p class="mt-1 text-xs text-heg-gris/60">Formats acceptés : JPG, PNG. Taille conseillée : 400x400 pixels.</p>
            </div>
            <div class="form-control">
                <label class="label text-sm font-medium text-heg-gris">Contact</label>
                {{ form.contact }}
                {% if form.contact.errors %}
                    <p class="mt-1 text-xs text-heg-violet">{{ form.contact.errors.0 }}</p>
                {% endif %}
            </div>
            <div class="form-control">
                <label class="label text-sm font-medium text-heg-gris">Poste / Fonction</label>
                {% if not is_admin %}
                    <input type="text" name="poste" value="{{ form.poste.value|default:profile.poste|default:'' }}" class="input input-bordered border-[#58595b] w-full bg-gray-100 cursor-not-allowed" readonly>
                    <p class="mt-1 text-xs text-heg-gris/60">Ce champ est en lecture seule. Seul un administrateur peut le modifier.</p>
                {% else %}
                    {{ form.poste }}
                {% endif %}
                {% if form.poste.errors %}
                    <p class="mt-1 text-xs text-heg-violet">{{ form.poste.errors.0 }}</p>
                {% endif %}
            </div>
            <div class="form-control md:col-span-2">
                <label class="label text-sm font-medium text-heg-gris">Biographie / Notes</label>
                {{ form.bio }}
                {% if form.bio.errors %}
                    <p class="mt-1 text-xs text-heg-violet">{{ form.bio.errors.0 }}</p>
                {% endif %}
            </div>
            <div class="md:col-span-2 flex justify-end gap-3">
                <a href="{% url 'cantine:dashboard_redirect' %}" class="btn btn-ghost border border-heg-gris/30 text-heg-gris hover:border-heg-violet hover:text-heg-violet">Annuler</a>
                <button type="submit" class="btn bg-heg-violet text-white hover:bg-heg-violetDark">Enregistrer les modifications</button>
            </div>
        </form>
    </div>
</section>
{% endblock %}

